# Инструкции по тестированию

## Установка зависимостей

```bash
pip install pytest pytest-asyncio pytest-cov
```

## Запуск тестов в Docker

### Запуск всех тестов

```bash
docker-compose run --rm tests
```

### Запуск конкретного теста

```bash
docker-compose run --rm tests pytest tests/test_performance.py -v
```

### Запуск с отчетом о покрытии

```bash
docker-compose run --rm tests pytest tests/ --cov=bot --cov-report=term-missing
```

## Бенчмаркинг

Для запуска бенчмарков производительности:

```bash
docker-compose run --rm tests python tests/benchmark.py
```

Бенчмарки проверяют:
1. Производительность кэширования
2. Скорость работы middleware
3. Время отклика MEXC API
4. Эффективность массовой обработки

## Интерпретация результатов

### Тесты производительности

- Время записи/чтения кэша должно быть менее 0.1 секунды на 1000 операций
- Обработка 100 сообщений middleware должна занимать менее 1 секунды
- Запросы к MEXC API должны выполняться менее чем за 0.5 секунды каждый
- Массовая обработка должна показывать ускорение минимум в 2 раза

### Ошибка 700007

Если при тестировании возникает ошибка 700007:
1. Проверьте, что IP-адрес сервера добавлен в список доверенных IP в настройках API ключа на MEXC
2. Убедитесь, что API ключ имеет необходимые разрешения (не только чтение)
3. Проверьте правильность API ключа и секрета

## Мониторинг производительности

Для мониторинга производительности в реальном времени:

```bash
docker-compose exec tests tail -f logs/performance.log
```

## Рекомендации по оптимизации

1. Если время отклика middleware превышает 1 секунду:
   - Увеличьте размер кэша
   - Оптимизируйте запросы к базе данных
   - Используйте bulk операции

2. Если запросы к MEXC API медленные:
   - Проверьте сетевое соединение
   - Увеличьте таймауты
   - Используйте пул соединений

3. Если массовая обработка не показывает значительного ускорения:
   - Увеличьте размер чанка
   - Оптимизируйте функцию обработки
   - Используйте асинхронные операции 